/*! grunt 2015-01-26 */
require.config({baseUrl:"/h5/dist",paths:{zepto:"libs/zepto.min",jquery:"libs/jquery-2.1.3.min"}}),define(["jquery","utils/caimi-core-ajax","utils/caimi-core-layer","utils/caimi-core-url","utils/caimi-core-form","utils/caimi-imgload"],function(a,b,c,d,e,f){var g=function(){var c,f,g,h,i={},j={},k=b.version,l=e.validator();return l.config={isPhone:"isPhone",isCode:"isCode"},l.type={isPhone:{validate:function(a){var b=a.val(),c={},d=/^1[3456789]\d{9}$/;return c.obj=a,d.test(b)?(c.bBtn=!0,j.mobile=b):(c.bBtn=!1,c.msg=this.msg[1]),c},msg:["亲，手机号不能为空哦~","亲，手机号输入不正确哦"]},isCode:{validate:function(a){var b=a.val(),c={},d=/^[0-9]{6}$/;return c.obj=a,d.test(b)?(c.bBtn=!0,j.code=b):(c.bBtn=!1,c.msg=this.msg[1]),c},msg:["亲，验证码不能为空哦~","亲，验证码输入不正确哦"]}},i={init:function(){var e,k,m=!0;c=a(".tag-phone input"),f=a(".send-btn"),g=a(" .tag-code input"),h=a(".sub-form"),e=function(a){var e=l.validate({isPhone:c});a.stopPropagation(),e?i.error(e.msg):m&&(k(),b.post(d.mobile,j,function(a){"0000"===a.code?i.error():"1016"===a.code?(a.msg="您已注册过<br/>请立即下载客户端参与活动",i.showStatus(1,a.msg)):i.error(a.msg)}))},f.on("touchend click",e),k=function(){function a(){f.html(c+"秒").removeClass("active")}var b=null,c=60;m=!1,a(),b=setInterval(function(){c--,a(),0===c&&(clearInterval(b),f.html("发送验证码"),m=!0)},1e3)},i.subPhone()},subPhone:function(){var e,f=!0;e=function(){var e=l.validate({isPhone:c,isCode:g});j.pid=a(".register input").eq(0).val(),j.shareUserId=a(".register input").eq(1).val(),e?i.error(e.msg):f&&(f=!1,b.post(d.register,j,function(a){"0000"===a.code?i.showStatus(1):(i.error(a.msg),f=!0)}))},h.on("touchend click",e)},downloadApp:function(){var b=a(".receive-btn");b.on("touchend click",function(a){a.preventDefault(),a.stopPropagation(),k.android?location.href="http://fusion.qq.com/cgi-bin/qzapps/unified_jump?appid=11270323":k.weixin?(i.addImg(),location.hash="over"):location.href="https://itunes.apple.com/cn/app/cai-mi-cai-piao/id946737222?mt=8"})},addImg:function(){var b=a("#iosLayer");b.length?b.show():a("body").append('<div id="iosLayer"><img src="/h5/images/activitys/ios-downlod.png" /></div>'),a("#iosLayer").on("touchend",function(){a(this).hide()})},showStatus:function(b,c){var d=a(".receive p"),e=a(".receive-btn"),f=a(".btn_zclq");e.show(),f.hide(),d.show(),c&&d.html(c),setTimeout(function(){a("#layer").hide(),i.downloadApp()},300)},error:function(b){var c=a(".error-tips");c.html(b?b:"")}}}(),h=function(){return{init:function(){f.imgLoad(a("img[_src]").get(),function(){a(".loading").hide().next().show()}),a(".btn_zclq").on("touchend click",function(b){b.preventDefault(),f.imgLoad(a("textarea[_s]").get(),function(){setTimeout(function(){c.layer(a("#templ").val()),g.init()},200)})}),!function(){var a=location.hash;a.indexOf("over")>-1&&(g.showStatus(1),g.downloadApp(1))}()}}}();h.init()});